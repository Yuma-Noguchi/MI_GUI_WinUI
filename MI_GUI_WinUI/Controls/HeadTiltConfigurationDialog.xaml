<ContentDialog
    x:Class="MI_GUI_WinUI.Controls.HeadTiltConfigurationDialog"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:local="using:MI_GUI_WinUI.Controls"
    xmlns:models="using:MI_GUI_WinUI.Models"
    xmlns:viewmodels="using:MI_GUI_WinUI.ViewModels"
    xmlns:converters="using:MI_GUI_WinUI.Converters"
    mc:Ignorable="d"
    d:DataContext="{d:DesignInstance Type=viewmodels:HeadTiltConfigurationViewModel}"
    Title="Configure Head Tilt"
    DefaultButton="Primary"
    PrimaryButtonText="Save"
    CloseButtonText="Cancel"
    Style="{ThemeResource DefaultContentDialogStyle}">

    <ContentDialog.Resources>
        <converters:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
        <x:Double x:Key="ContentDialogMaxWidth">600</x:Double>
    </ContentDialog.Resources>

    <ScrollViewer>
        <StackPanel Spacing="12">
            <InfoBar
                IsOpen="{x:Bind ViewModel.HasValidationMessage, Mode=OneWay}"
                Message="{x:Bind ViewModel.ValidationMessage, Mode=OneWay}"
                Severity="Error"
                IsClosable="False"/>

            <!-- Enable/Disable Toggle -->
            <ToggleSwitch
                Header="Enable Head Tilt Driving"
                IsOn="{x:Bind ViewModel.IsEnabled, Mode=TwoWay}"/>

            <!-- Configuration Panel -->
            <StackPanel 
                Visibility="{x:Bind ViewModel.IsEnabled, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}"
                Spacing="12">
                
                <TextBlock Text="Head Tilt Settings" 
                          Style="{ThemeResource SubtitleTextBlockStyle}"/>

                <Grid ColumnSpacing="12" RowSpacing="8">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <!-- Sensitivity -->
                    <NumberBox Grid.Column="0" Grid.Row="0"
                              Header="Sensitivity"
                              Value="{x:Bind ViewModel.Sensitivity, Mode=TwoWay}"
                              SpinButtonPlacementMode="Compact"
                              Minimum="0.1"
                              Maximum="1.0"
                              SmallChange="0.05"
                              ToolTipService.ToolTip="Adjust the sensitivity of head tilt detection"/>

                    <!-- Deadzone -->
                    <NumberBox Grid.Column="1" Grid.Row="0"
                              Header="Deadzone"
                              Value="{x:Bind ViewModel.Deadzone, Mode=TwoWay}"
                              SpinButtonPlacementMode="Compact"
                              Minimum="0.1"
                              Maximum="5.0"
                              SmallChange="0.1"
                              ToolTipService.ToolTip="Set the minimum tilt angle required for detection"/>

                    <!-- Linear Mode -->
                    <CheckBox Grid.Column="0" Grid.Row="1"
                             Content="Linear Movement"
                             IsChecked="{x:Bind ViewModel.Linear, Mode=TwoWay}"
                             ToolTipService.ToolTip="Enable for linear movement response"/>

                    <!-- Skin Paths Info -->
                    <StackPanel Grid.ColumnSpan="2" Grid.Row="2" 
                              Margin="0,8,0,0"
                              Padding="12"
                              BorderBrush="{ThemeResource SystemControlForegroundBaseMediumBrush}"
                              BorderThickness="1">
                        <TextBlock Text="Visual Indicators" 
                                 Style="{ThemeResource CaptionTextBlockStyle}"
                                 Margin="0,0,0,4"/>
                        <TextBlock Text="Left Tilt: racing/left_arrow.png"
                                 Style="{ThemeResource CaptionTextBlockStyle}"/>
                        <TextBlock Text="Right Tilt: racing/right_arrow.png"
                                 Style="{ThemeResource CaptionTextBlockStyle}"/>
                    </StackPanel>
                </Grid>

                <!-- Help Text -->
                <InfoBar
                    IsOpen="True"
                    Severity="Informational"
                    Title="How it works"
                    Message="Head tilt driving allows you to control movement by tilting your head left or right. Adjust the sensitivity and deadzone to fine-tune the response to your head movements."
                    IsClosable="False"/>
            </StackPanel>
        </StackPanel>
    </ScrollViewer>
</ContentDialog>